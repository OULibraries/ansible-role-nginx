---
- name: SSL literal cert directory exists
  file:
    path: "{{ nginx_cert_path }}/{{ item.name }}"
    state: directory
  with_items: nginx_literal_sites
- name: SSL literal key directory exists
  file:
    path: "{{ nginx_key_path }}/{{ item.name }}"
    state: directory
  with_items: nginx_literal_sites
- name: Self-signed literal cert exists.
  become: true
  command: >
     openssl req -newkey rsa:2048 -nodes -sha256 -x509 
     -subj "/CN={{ item.name }}" 
     -days 90 
     -keyout "{{ nginx_key_path }}"/"{{ item.name }}"/privkey.pem 
     -out "{{ nginx_cert_path }}"/"{{ item.name }}"/fullchain.pem
  args:
    creates: "{{ nginx_key_path }}/{{ item.name }}/fullchain.pem"
  with_items: nginx_literal_sites
